<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>정신건강 및 자살예방 메뉴얼</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background-color: #f7f7f7; }
    .section { margin-bottom: 2rem; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input[type="radio"] { margin-right: 0.3rem; }
    label { margin-right: 1rem; cursor: pointer; }
    button {
      display: block;
      margin: 0.3rem 0;
      padding: 0.4rem 1rem;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #ccc;
      background-color: #eee;
    }
    button.active, .flow-button.selected { background-color: #007BFF; color: white; border-color: #007BFF; }
    .sub-content { margin-top: 0.5rem; background: #eef; padding: 0.8rem; border-radius: 4px; }
    
    .detail-list {
      list-style: none;   /* 점 없애기 */
      padding-left: 0;
      margin-left: 0;
    }

    .detail-list .depth1 {
      margin-left: 0;     /* 최상위 */
    }

    .detail-list .depth2 {
      margin-left: 1.5rem;  /* depth1 하위 */
    }

    .detail-list .depth3 {
      margin-left: 3rem;    /* depth2 하위 */
    }
    
    .flow-section { margin-top: 0.8rem; margin-left: 1rem; border-left: 3px solid #007BFF; padding-left: 1rem; background: #f0f8ff; border-radius: 4px; }
    .hidden { display: none; }
    .flow-button { margin: 0.3rem 0.5rem 0.3rem 0; padding: 0.5rem 1rem; border: 1px solid #ccc; background-color: #fff; cursor: pointer; border-radius: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    table, th, td { border: 1px solid #aaa; }
    th, td { padding: 0.5rem; text-align: center; }
  </style>
</head>
<body>
  <h1 style="text-align:center; margin-top:0; padding:1rem 0; font-size:1.8rem;">
    정신질환자 처리 메뉴얼
  </h1>
  
  <div class="section">
  <h2>1. 해당 항목 선택</h2>
  <input type="radio" name="category" value="자의입원" id="self" />
  <label for="self">자의입원</label>

  <input type="radio" name="category" value="동의입원" id="consent" />
  <label for="consent">동의입원</label>

  <input type="radio" name="category" value="보호입원" id="guardian" />
  <label for="guardian">보호입원</label>

  <input type="radio" name="category" value="행정입원" id="admin" />
  <label for="admin">행정입원</label>

  <input type="radio" name="category" value="응급입원" id="emergency" />
  <label for="emergency">응급입원</label>
</div>

  <div class="section hidden" id="procedure-section">
    <h2>2. 절차</h2>
    <div id="procedure-buttons"></div>
  </div>

  <div class="section hidden" id="checklist-section">
    <h2>3. 체크사항</h2>
    <div id="checklist-buttons"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const data = {
      "자의입원": {
        "절차": ["전문의 면담", "자의입원 신청", "입원", "퇴원신청", "퇴원"],
        "핵심체크": ["입원 대상자 요건","병원의무사항"],
        "절차내용": {
          "전문의 면담": [
            {"text": "➢ 정신질환자 본인","depth": 1}],
          "자의입원 신청": [
            {"text": "➢ 전문의와 면담","depth": 1},
            {"text": "➢ 정신질환자 본인 자필 신청서 제출","depth": 1}],
          "입원": [
            {"text": "➢ 입원수속","depth": 1}],
          "퇴원신청": [
            {"text": "➢ 환자 본인 퇴원 신청","depth": 1}], 
          "퇴원": [
            {"text": "➢ 지체 없이 퇴원","depth": 1}],
        },
        "핵심체크내용": {
          "입원 대상자 요건": [
            {"text": "➢ 정신질환자","depth": 1},
            {"text": "➢ 그 밖에 정신건강상 문제가 있는 사람","depth": 1}],
          "병원의무사항": [
            {"text": "➢ 2개월 마다 환자의 퇴원의사 확인","depth": 1}],
        }
      },
      "동의입원": {
        "절차": ["전문의 면담", "동의입원 신청", "입원", "퇴원 신청", "보호의무자 퇴원 동의 여부"],
        "핵심체크": ["입원 대상자 요건"],
        "절차내용": {
          "전문의 면담": [
            {"text": "전문의 면담<br>↓<br>입원 권고","depth": 1}],
          "동의입원 신청": [
             {"text": "보호의무자 동의<br>↓<br>환자 자필 동의입원 신청서 작성","depth": 1}],
          "입원": [
            {"text": "➢ 입원수속","depth": 1}],
          "퇴원 신청": [
            {"text": "➢ 환자 본인이 신청","depth": 1}],
          "보호의무자 퇴원 동의 여부": [
            {"text": "➢ 환자 본인의 퇴원 요청시","depth": 1},
            {"text": "→ 보호의무자 동의 여부 확인","depth": 2}],
         },
        "핵심체크내용": {
          "입원 대상자 요건": [
            {"text": "➢ 정신질환자","depth": 1}],
        }
      },
      "보호입원": {
        "절차": ["전문의 진단 및 입원결정", "보호입원 신청", "2주 이내 전문의 추가소견","입원유지","입원적합성심사","입원 연장"],
        "핵심체크": ["입원 대상자 요건"],
        "절차내용":{
          "전문의 진단 및 입원결정":[{"text":"➤ 전문의 진단 후 입원결정","depth":1}],
          "보호입원 신청":[
           {"text":"➤ 보호입원 신청서 제출","depth":1},
           {"text":"→ 보호의무자 2인 자필 동의 필요","depth":2}
           ],
         "2주 이내 전문의 추가소견":[
           {"text":"➤ 입원 후 2주 내 다른 정신건강의료기관 전문의 소견 추가(불일치=퇴원)","depth":1},
           ],
         "입원유지":[{"text":"➤ 두 의사 의견 일치 시 유지","depth":1}],
         "입원적합성심사":[
           {"text":"➤ 입원일로부터 1개월 내 완료(부적합=퇴원)","depth":1},
           {"text":"→ 입원시 권리고지 받을 때 입원적합성심사 신청","depth":2}],
         "입원 연장":[{"text":"➤ 심사 필요","depth":1}]
         },
             
        "핵심체크내용": {
         "입원 대상자 요건": [
            {"text": "➢ 정신질환 + 자 타의 위혐(보건복지부령으로 정함) ","depth": 1},
            {"text": "→ 정신질환자만 대상","depth": 2},
            {"text": "→ 자의입원은 정신건강에 문제가 있는 사람도 대상","depth": 2},
            {"text": "➢ 정신건강복지법 의 정신질환자 ","depth": 1},
            {"text": "→ 정신질환으로 독립적으로 일상생활에 중대한 제약이 있는 사람 ","depth": 2},
            {"text": "→ 중대한 제약이 있는지 여부는 전문의가 판단함","depth": 2}],
          }
       },
        
       "행정입원": {
        "절차": ["진단 및 보호신청", "진단을 위한 행정입원","치료를 위한 행정입원",],
        "핵심체크": ["입원 대상자 요건"],
        "절차내용": {
          "진단 및 보호신청": [
            {"text": "대상자 발견<br>↓<br>정신건강전문요원에게 진단과 보호 신청을 요청(경찰관)<br>↓<br>지자체장에게 진단과 보호를 신청(정신건강의학과 전문의)<br>↓<br>전문의에게 진단 의뢰(지자체장)<br>↓<br>지자체장에게 결과 통지(전문의)<br>↓<br>지정정신의료기관에 진단을 위한 행정입원 의뢰 또는 귀가조치(지자체장)","depth": 1}],
             

          "진단을 위한 행정입원": [
            {"text": "진단입원(최장 2주)<br>↓<br>2인 전문의 진단 결과를 지자체장에게 통지(정신의료기관장)<br>↓<br>치료입원 의견 통지시 치료 입원 의뢰(지자체장)","depth": 1}],
          
          "치료를 위한 행정입원": [
            {"text": "➢ 최장 3개월 입원을 유지 가능(정신의료기관장)","depth": 1},
            {"text": "→ 입원적합성심사위위원회의 심사결과 '퇴원등'으로 통지를 받은 경우 즉시 퇴원","depth": 2},
            {"text": "→ 입원 당사자 또는 보호의무자의 퇴원 신청이 있을 경우 심사하고 그 결과에 따름","depth": 2},
            {"text": "→ 입원기간을 연장하기 위해서는 3개월 이내에 2인 이상 전문의 등 심사 필요","depth": 2}],

         },
        "핵심체크내용": {
          "입원 대상자 요건": [
            {"text": "➢ 자 타의 위험","depth": 1},
            {"text": "➢ 시간적 긴급(X)","depth": 1}],
         }
      },
        
       "응급입원": {
        "절차": ["응급입원의뢰 신청", "3일간 응급입원 및 전문의 진단", "입원필요성 및 입원유형전환"],
        "핵심체크": ["입원 대상자 요건","서울청 정신응급 합동대응센터","정신질환자 치료연계 협업병원","주취자 응급의료센터 연락처","입원적합성심사위원회 설치기관","자살시도자 절차","자살시도자 사후관리"],
        "절차내용": {
          "응급입원의뢰 신청": [
            {"text": "➢ 입원 대상자를 발견한 사람이 신청","depth": 1},
            {"text": "→ 의사 및 경찰관의 동의 필요","depth": 2},
            {"text": "→ 의사는 정신건강의학과전문의일 필요 없음","depth": 2},
            {"text": "→ 경찰관이 응급입원 의뢰서 신청자일 경우","depth": 2},
            {"text": "→ 응급입원 동의 경찰관은 다른 경찰관이어햐 함","depth": 3}],
          "3일간 응급입원 및 전문의 진단": [
            {"text": "➢ 3일 응급입원 중 전문의 진단","depth": 1}],
          "입원필요성 및 입원유형전환": [
            {"text": "진단 결과 계속 입원 필요 인정된 경우<br>↓<br>보호입원/행정입원으로 전환<br>↓<br>입원할 필요가 없다고 인정된 경우→즉시 퇴원","depth": 1}],
         },
        "핵심체크내용": {
          "입원 대상자 요건": [
            {"text": "➢ 정신질환자로 추정 + 자 타의 위험 + 시간적 긴급","depth": 1}],



          
          "서울청 정신응급 합동대응센터": [
            {"text": "➢ 연락처: 02-700-2912/3//- 야간, 휴일(17:30~익일 08:30)- 현장경찰 지원 요청시 현장출동 전담 처리//- 주간, 평일: 코칭, 병상정보, 이송지원(현장경찰 응급입원 이송 후 복귀했으나 병상이 없어 타병원 재이송이 필요한 경우 현정경찰 대신 재이송 업무도 처리)","depth": 1}],




          
          "입원적합성심사위원회 설치기관": [
            {"text": "➢ 국립정신건강센터 02-2204-0156","depth": 1}],
          "자살시도자 절차": [
            {"text": "➢ 응급입원 절차에 따라 입원//","depth": 1}],
          "자살시도자 사후관리": [
            {"text": "➢ 자살시도자 등에게 관계 지원기관 정보 제공","depth": 1},
            {"text": "→ 서면, 전자우편 또는 휴대폰메시지","depth": 2},
            {"text": "➢ '자살시도자 등 개인정보 제공내역서'(생활질서계 통보)","depth": 1},
            {"text": "→ 자살시도자 등의 동의 필요 없음 ","depth": 2}],
                
         }
      },
    };

      const procedureSection = document.getElementById('procedure-section');
      const checklistSection = document.getElementById('checklist-section');
      const procedureButtonsDiv = document.getElementById('procedure-buttons');
      const checklistButtonsDiv = document.getElementById('checklist-buttons');

      // 개선된 formatText 함수
      const formatText = (text) => {
        // Step 1: 마커를 임시 토큰으로 변환
        text = text
          .replace(/b(.*?)b/gs, '[[BLUE::$1]]')
          .replace(/r(.*?)r/gs, '[[RED::$1]]');

        // Step 2: HTML escape
        text = text
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;")
          .replace(/\/\//g, '<br>');

        // Step 3: 토큰 복원
        text = text
          .replace(/\[\[BLUE::(.*?)\]\]/gs, '<span style="color:blue;">$1</span>')
          .replace(/\[\[RED::(.*?)\]\]/gs, '<span style="color:red;">$1</span>');

        return text;
      };

      const createButton = (text, onClick) => {
        const btn = document.createElement('button');
        btn.textContent = text;
        btn.className = 'flow-button';
        btn.onclick = onClick;
        return btn;
      };

      const toggleActive = (button, container) => {
        container.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
      };

      const removeFlowBelow = (container) => {
        container.querySelectorAll('.flow-section').forEach(el => el.remove());
      };

      const createContent = (category, key, section) => {
        const container = document.createElement('div');
        container.className = 'sub-content';

        if (category === "응급입원" &&(key === "정신질환자 치료연계 협업병원" || key === "주취자 응급의료센터 연락처")) {
          const table = document.createElement('table');
          table.innerHTML = `
            <tr><th>병원이름</th><th>전화번호</th><th>이용가능시간</th><th>병원위치</th></tr>
          `;
          data[category].핵심체크내용[key].forEach(row => {
            const tr = document.createElement('tr');
            row.forEach(cell => {
              const td = document.createElement('td');
              td.innerHTML = formatText(cell);
              tr.appendChild(td);
            });
            table.appendChild(tr);
          });
          container.appendChild(table);
          return container;
        }

        const items = data[category][section + "내용"][key] || [];
        const ul = document.createElement('ul');
        ul.className = 'detail-list';
        
        items.forEach(item => {
          const li = document.createElement('li');

          if (typeof item === 'object' && item.text) {
            li.innerHTML = item.text;
            li.className = 'depth' + (item.depth || 1);

            // 🔥 "전문의 면담" 절차 흐름 전체만 중앙 정렬
            if (item.text.includes("전문의 면담") && item.text.includes("입원 권고")) {
              li.style.textAlign = "center";
            }
            if (item.text.includes("보호의무자 동의") && item.text.includes("환자 자필")) {
              li.style.textAlign = "center";
            }
            if (item.text.includes("대상자 발견")) {
              li.style.textAlign = "center";
            }
            if (item.text.includes("치료입원 의견 통지시")) {
              li.style.textAlign = "center";
            }
            if (item.text.includes("보호입원/행정입원")) {
              li.style.textAlign = "center";
            }

          } else {
            li.innerHTML = formatText(item);
            li.className = 'depth1';
          }

          ul.appendChild(li);
        });
        
        container.appendChild(ul);

        if (key === "보호의무자 퇴원 동의 여부") {
          const agreeBtn = createButton("동의하는 경우", () => {
            removeFlowBelow(container);
            const flow = document.createElement('div');
            flow.className = 'flow-section';
            flow.innerHTML = `<strong>→ 퇴원</strong>`;
            container.appendChild(flow);
          });
          const disagreeBtn = createButton("동의하지 않는 경우", () => {
            removeFlowBelow(container);
            const flow = document.createElement('div');
            flow.className = 'flow-section';
            flow.innerHTML = `<strong>→ 의사 판단에 따라 결정됨</strong>`;
            const yesBtn = createButton("치료 필요 없음", () => {
              removeFlowBelow(container);
              const res = document.createElement('div');
              res.className = 'flow-section';
              res.innerHTML = `<strong>→ 퇴원</strong>`;
              container.appendChild(res);
            });
            const noBtn = createButton("치료 필요 있음", () => {
              removeFlowBelow(container);
              const res = document.createElement('div');
              res.className = 'flow-section';
              res.innerHTML = `<strong>→ 퇴원거부 후 보호입원 또는 행정입원 전환</strong>`;
              container.appendChild(res);
            });
            container.appendChild(flow);
            flow.appendChild(yesBtn);
            flow.appendChild(noBtn);
          });
          container.appendChild(agreeBtn);
          container.appendChild(disagreeBtn);
        }

        return container;
      };

      document.querySelectorAll('input[name="category"]').forEach(radio => {
        radio.addEventListener('change', () => {
          const selected = radio.value;
          procedureButtonsDiv.innerHTML = '';
          checklistButtonsDiv.innerHTML = '';
          procedureSection.classList.remove('hidden');
          checklistSection.classList.remove('hidden');

          data[selected].절차.forEach(proc => {
            const btn = document.createElement('button');
            btn.textContent = proc;
            btn.onclick = () => {
              toggleActive(btn, procedureButtonsDiv);
              const existing = procedureButtonsDiv.querySelector('.sub-content');
              if (existing) existing.remove();
              const content = createContent(selected, proc, "절차");
              btn.insertAdjacentElement('afterend', content);
            };
            procedureButtonsDiv.appendChild(btn);
          });

          data[selected].핵심체크.forEach(item => {
            const btn = document.createElement('button');
            btn.textContent = item;
            btn.onclick = () => {
              toggleActive(btn, checklistButtonsDiv);
              const existing = checklistButtonsDiv.querySelector('.sub-content');
              if (existing) existing.remove();
              const content = createContent(selected, item, "핵심체크");
              btn.insertAdjacentElement('afterend', content);
            };
            checklistButtonsDiv.appendChild(btn);
          });
        });
      });
    });
  </script>

<!-- 여기에 의견 남기기 버튼 삽입 -->
<div style="margin-top: 1.5rem; text-align: center;">
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSdq-BtCklTCrpnL07spxS2Q6SNjLQEnY0nrog12Zk3H0MrDLg/viewform?embedded=true" 
     target="_blank"
     style="
       display: inline-block;
       padding: 0.7rem 1.4rem;
       background: #4CAF50;
       color: white;
       font-size: 1rem;
       font-weight: bold;
       border-radius: 6px;
       text-decoration: none;
       box-shadow: 0 3px 6px rgba(0,0,0,0.2);
       transition: 0.2s;
     "
     onmouseover="this.style.opacity='0.85'"
     onmouseout="this.style.opacity='1'"
  >
    오류 & 추가 의견 남기기
  </a>
</div>

</body>
</html>
















